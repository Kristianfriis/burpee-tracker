<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">
    <title>Burpee Tracker</title>
    <!-- Load Tailwind CSS for modern, responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles override Tailwind for the calendar grid */
        .weekdays, .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .day-box {
            height: 50px; /* Fixed height for consistent look */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.1s;
            position: relative;
            user-select: none;
            text-align: center;
        }

        /* Styling for the completion circle */
        .completed-day {
            color: transparent; /* Hide the main day number */
            font-size: 0; /* Ensures only the content from ::after shows */
        }

        .completed-day::after {
            content: attr(data-burpees);
            width: 80%;
            height: 80%;
            border: 2px solid #10b981; /* Tailwind green-500 */
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.75rem; /* Small text for the count */
            font-weight: bold;
            color: #059669; /* Tailwind green-600 */
            background-color: #d1fae5; /* Tailwind green-100 */
        }
        
        /* Ensure the day number shows clearly inside the circle area */
        .day-box > span {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.875rem; /* text-sm */
            color: #374151; /* gray-700 */
        }

        .day-box.completed-day > span {
             /* When completed, the content is handled by ::after, so day number is hidden */
            display: none; 
        }

        .day-box.current-month > span {
            color: #374151; /* gray-700 */
        }

        .day-box.not-current-month > span {
            color: #a0aec0; /* gray-400 */
        }

        .day-box.selected {
            background-color: #bfdbfe; /* blue-200 */
            border: 1px solid #60a5fa; /* blue-400 */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4 font-sans">

    <div class="max-w-md w-full bg-white p-6 md:p-8 rounded-xl shadow-2xl space-y-6">
        <h1 class="text-3xl font-extrabold text-center text-indigo-700">Burpee Tracker ðŸ’ª</h1>

        <!-- Calendar Section -->
        <div class="calendar border border-gray-200 rounded-lg p-4">
            <div class="header flex justify-between items-center mb-4">
                <button id="prevMonth" class="text-xl font-bold p-2 bg-indigo-100 text-indigo-700 rounded-full hover:bg-indigo-200 transition-colors">&lt;</button>
                <h2 id="monthYear" class="text-xl font-semibold text-gray-800"></h2>
                <button id="nextMonth" class="text-xl font-bold p-2 bg-indigo-100 text-indigo-700 rounded-full hover:bg-indigo-200 transition-colors">&gt;</button>
            </div>

            <div class="weekdays text-sm font-medium text-gray-500 mb-2">
                <span>Sun</span>
                <span>Mon</span>
                <span>Tue</span>
                <span>Wed</span>
                <span>Thu</span>
                <span>Fri</span>
                <span>Sat</span>
            </div>

            <div class="days-grid" id="daysGrid">
                <!-- Days will be generated by JavaScript -->
            </div>
        </div>

        <!-- Input Form Section -->
        <div class="input-form bg-indigo-50 p-5 rounded-lg border-t-4 border-indigo-500">
            <h3 class="text-lg font-semibold text-gray-700 mb-3">Log Burpees for <span id="selectedDateText" class="text-indigo-600 font-bold">Today</span></h3>
            
            <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3">
                <input type="number" id="burpeeCount" placeholder="Number of burpees" min="0" 
                       class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-shadow text-center">
                
                <button id="logBurpees" 
                        class="p-3 bg-green-500 text-white font-semibold rounded-lg shadow-md hover:bg-green-600 transition-colors transform hover:scale-105">
                    Log Activity
                </button>
            </div>

            <p id="todayCount" class="mt-4 text-center text-sm font-medium text-gray-600">
                Current Count: 0 burpees
            </p>
            <p id="messageBox" class="text-center mt-2 text-sm text-red-500 hidden"></p>
        </div>
    </div>

    <script>
        const daysGrid = document.getElementById('daysGrid');
        const monthYearText = document.getElementById('monthYear');
        const prevMonthBtn = document.getElementById('prevMonth');
        const nextMonthBtn = document.getElementById('nextMonth');
        const logBurpeesBtn = document.getElementById('logBurpees');
        const burpeeCountInput = document.getElementById('burpeeCount');
        const selectedDateText = document.getElementById('selectedDateText');
        const todayCountP = document.getElementById('todayCount');
        const messageBox = document.getElementById('messageBox');

        let currentDate = new Date();
        let currentYear = currentDate.getFullYear();
        let currentMonth = currentDate.getMonth();
        let selectedDay = currentDate.getDate();

        // --- Local Storage Functions ---

        // Key for storing burpee data
        const STORAGE_KEY = 'burpeeTrackerData';

        /**
         * Retrieves all burpee data from local storage.
         * @returns {Object} An object where keys are date strings (YYYY-MM-DD) and values are burpee counts.
         */
        function getBurpeeData() {
            try {
                const data = localStorage.getItem(STORAGE_KEY);
                return data ? JSON.parse(data) : {};
            } catch (e) {
                console.error("Error loading data from localStorage:", e);
                return {};
            }
        }

        /**
         * Saves a burpee count for a specific date to local storage.
         * @param {string} dateString - The date key in YYYY-MM-DD format.
         * @param {number} count - The number of burpees completed.
         */
        function saveBurpeeCount(dateString, count) {
            try {
                const data = getBurpeeData();
                data[dateString] = count;
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                showMessage(`Logged ${count} burpees for ${selectedDateText.textContent}`, 'text-green-500');
            } catch (e) {
                console.error("Error saving data to localStorage:", e);
                showMessage("Could not save data. Local storage might be full.", 'text-red-500');
            }
        }
        
        /**
         * Shows a temporary message to the user.
         * @param {string} text - The message content.
         * @param {string} colorClass - Tailwind class for color (e.g., 'text-green-500').
         */
        function showMessage(text, colorClass) {
            messageBox.textContent = text;
            messageBox.className = `text-center mt-2 text-sm ${colorClass}`;
            setTimeout(() => {
                messageBox.className = 'text-center mt-2 text-sm hidden';
            }, 3000);
        }

        // --- Calendar Rendering and Logic ---

        /**
         * Converts a Date object to a YYYY-MM-DD string.
         * @param {Date} date - The date to format.
         * @returns {string} The formatted date string.
         */
        function formatDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }

        /**
         * Renders the calendar grid for the current month/year.
         */
        function renderCalendar() {
            const firstDayOfMonth = new Date(currentYear, currentMonth, 1);
            const lastDayOfMonth = new Date(currentYear, currentMonth + 1, 0);
            const daysInMonth = lastDayOfMonth.getDate();

            // Get the day of the week for the 1st (0=Sun, 6=Sat)
            const firstDayIndex = firstDayOfMonth.getDay(); 
            
            // Day from the previous month to display
            const daysFromPrevMonth = firstDayIndex; 
            const prevMonthLastDay = new Date(currentYear, currentMonth, 0).getDate();

            daysGrid.innerHTML = ''; // Clear previous days

            const burpeeData = getBurpeeData();

            // 1. Fill in the leading days from the previous month
            for (let i = daysFromPrevMonth; i > 0; i--) {
                const dayBox = createDayBox(prevMonthLastDay - i + 1, false, null, 0, false);
                daysGrid.appendChild(dayBox);
            }

            // 2. Fill in the days of the current month
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(currentYear, currentMonth, day);
                const dateString = formatDate(date);
                const burpees = burpeeData[dateString] || 0;
                const isSelected = day === selectedDay;

                const dayBox = createDayBox(day, true, dateString, burpees, isSelected);

                // Add a date attribute for easy retrieval later, even if not completed
                dayBox.setAttribute('data-date', dateString);
                dayBox.addEventListener('click', () => selectDay(day));
                daysGrid.appendChild(dayBox);
            }

            // 3. Update the header and form date
            monthYearText.textContent = firstDayOfMonth.toLocaleDateString('en-US', {
                month: 'long',
                year: 'numeric'
            });
            
            // Adjust selectedDay if we navigated to a month with fewer days
            if (selectedDay > daysInMonth) {
                selectedDay = daysInMonth;
            }
            
            updateFormForSelectedDay();
        }

        /**
         * Creates a single day cell for the calendar.
         */
        function createDayBox(dayNumber, isCurrentMonth, dateString, burpees = 0, isSelected = false) {
            const dayBox = document.createElement('div');
            dayBox.classList.add('day-box', 'rounded-lg');
            
            const daySpan = document.createElement('span');
            daySpan.textContent = dayNumber;
            dayBox.appendChild(daySpan);

            if (isCurrentMonth) {
                dayBox.classList.add('current-month', 'hover:bg-gray-100');
                if (isSelected) {
                    dayBox.classList.add('selected');
                }
                
                // Add completion circle if burpees were logged
                if (burpees > 0) {
                    dayBox.classList.add('completed-day');
                    // The CSS ::after pseudo-element uses this data-burpees attribute
                    dayBox.setAttribute('data-burpees', burpees); 
                }
            } else {
                dayBox.classList.add('not-current-month');
            }

            return dayBox;
        }

        /**
         * Handles the selection of a new day.
         * @param {number} day - The day number (1-31) of the current month.
         */
        function selectDay(day) {
            selectedDay = day;
            renderCalendar(); // Re-render to update the 'selected' class
        }

        /**
         * Updates the input form to show details for the currently selected day.
         */
        function updateFormForSelectedDay() {
            const selectedDate = new Date(currentYear, currentMonth, selectedDay);
            const dateString = formatDate(selectedDate);
            
            // Update the header
            selectedDateText.textContent = selectedDate.toLocaleDateString('en-US', {
                weekday: 'short', 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric'
            });

            // Load burpee count for the selected day
            const burpeeData = getBurpeeData();
            const count = burpeeData[dateString] || 0;
            todayCountP.textContent = `Current Count: ${count} burpees`;
            burpeeCountInput.value = count > 0 ? count : ''; // Prefill input
            
            // Clear message box on day change
            messageBox.className = 'text-center mt-2 text-sm hidden';
        }


        // --- Event Listeners ---

        // Navigate to the previous month
        prevMonthBtn.addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        });

        // Navigate to the next month
        nextMonthBtn.addEventListener('click', () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        });

        // Log burpees for the selected day
        logBurpeesBtn.addEventListener('click', () => {
            const count = parseInt(burpeeCountInput.value);

            if (!isNaN(count) && count >= 0) {
                const selectedDate = new Date(currentYear, currentMonth, selectedDay);
                const dateString = formatDate(selectedDate);
                
                saveBurpeeCount(dateString, count);
                burpeeCountInput.value = ''; // Clear input
                renderCalendar(); // Re-render to show the new circle/count
                updateFormForSelectedDay(); // Update the logged count text
            } else {
                showMessage('Please enter a valid number (0 or greater).', 'text-red-500');
            }
        });


        // --- Initialisation ---
        
        // Find today's date to set the initial selection
        const today = new Date();
        if (currentYear === today.getFullYear() && currentMonth === today.getMonth()) {
            selectedDay = today.getDate();
        } else {
            selectedDay = 1; // Default to the 1st of the month if viewing a different month
        }

        renderCalendar();
    </script>
<script>
if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then((reg) => {
                        console.log('Service Worker registered successfully: ', reg);
                    })
                    .catch((error) => {
                        console.error('Service Worker registration failed:', error);
                    });
            });
        }</script>
</body>
</html>

